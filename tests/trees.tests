REBOL [
    Type: Module
    Title: "Tests for trees"
    Author: "Gabriele Santilli"
    Imports: [%mezz/trees.r]
]

[
    mold n: make-node 'root
]
[
	set-property n 'test 1
]
[
	get-property n 'test
]
[
	append-node n c: make-node 'child
	n = parent-node? c
]
[
	node-type? n
]
[
	node-type? c
]
[
	mold remove-node c
]
[
	mold n
]
[
	append-node n make-node 'child1
	append-node n make-node 'child2
	result: [ ]
	foreach-child node n [
		append result node-type? node
	]
	result
]
[
	node-type? c: first-child? n
]
[
	node-type? c: next-sibling? c
]
[
	next-sibling? c
]
[
	node-type? c: prev-sibling? c
]
[
	prev-sibling? c
]
[
	t: make-tree [
		html []
			[head []
				[title []]
				[meta [http-equiv: "Content-Type"]]
			]
			[body []
				[div [class: "Main"]
					[p []]
					[p []]
				]
				[div [class: "Footer"]
					[p [color: "grey"]]
				]
			]
	]
	mold-tree t
]
[
	; REBOL enters endless loop... :(
	;t = load-tree mold-tree t
]
[
	rewrite-tree t [
        [p [] **] followed by [p [] **] rewrite to [p [] ** next unwrapped]
    ]
	mold-tree t
]
[
    node? t
]
[
    node? first-child? t
]
[
    rewrite-tree t [
        [p [color: "grey"]] [p [color: #808080]]
    ]
    mold-tree t
]
[
    rewrite-tree t [
        [body [] main: [div [class: "Main"] **] footer: [div [class: "Footer"] **]]
            [body [*: *] footer rewritten to [div [class: "Header"] [p [class: "Menu"]] **] main]
        [meta [http-equiv: "Content-Type" value: #[none]]]
            [meta [http-equiv: "Content-Type" value: "text/html; charset=UTF-8"]]
    ]
    mold-tree t
]
[
    rewrite-tree t [
        [div [class: "Main"] **] unwrap
    ]
    mold-tree t
]
[
    t: make-tree [
        html []
            [body []
                [p []
                    [text [value: "something"]]
                    [i []
                        [br []] [text [value: "^/"]]
                    ]
                    [text [value: "something else"]]
                ]
            ]
    ]
    rewrite-tree t [
        [i [] [br []] [text [value: "^/"]]] unwrap
    ]
    mold-tree t
]
[
    t: make-tree [
        html []
            [body []
                [p []
                    [text [value: "something"]]
                    [span []
                        [text [value: "inside span"]]
                    ]
                    [span [style: "one"]
                        [text [value: "inside styled span"]]
                    ]
                    [text [value: "something else"]]
                ]
            ]
    ]
    rewrite-tree t [
        [span [style: #[none] id: #[none] dir: #[none]] **] unwrap
    ]
    mold-tree t
]
[
    t: make-tree [
        html []
            [body []
                [ul []
                    [li [] [text [value: "something"]] [br []]]
                    [li [] [text [value: "something else"]] [br []]]
                ]
            ]
    ]
    rewrite-tree t [
        [li [] ** [br []]] [* [*: *] 1 to -2]
    ]
    mold-tree t
]
