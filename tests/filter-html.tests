REBOL [
    Title: "Tests for the HTML filter"
    Author: "Gabriele Santilli"
    Tests: [%mezz/filter-html.r %dialects/fsm.r %mezz/module.r %parsers/ml-parser.r %mezz/normalize-html.r %parsers/uri-parser.r]
]

[
    do %mezz/module.r
    load-module/from what-dir
    load-module %mezz/filter-html.r
    true
]
[
    filter-html/all read %tests/data/rebol.com.html
]
[
    filter-html/all read %tests/data/w3.org.html
]
[
    filter-html/all read %tests/data/fairy.html
]
[
    filter-html/all read %tests/data/1.html
]
[
    filter-html/all read %tests/data/2.html
]
[
    filter-html/all read %tests/data/3.html
]
[
    filter-html/all read %tests/data/4.html
]
[
    filter-html/all read %tests/data/5.html
]
[
    filter-html/all read %tests/data/6.html
]
[
    filter-html/all read %tests/data/7.html
]
[
    filter-html/all read %tests/data/8.html
]
[
    filter-html/all read %tests/data/9.html
]
[
    filter-html/all read %tests/data/10.html
]
[
    filter-html/all read %tests/data/11.html
]
[
    filter-html {<p>This is a simple test.}
]
[
    filter-html/all {<p>This is a simple test.}
]
[
    filter-html/with {<p>This is a simple test.} [
        all: yes
    ]
]
[
    filter-html/all/with {<p>This is a simple test.} [ ]
]
[
    filter-html/with {<p id="mypara">This is a simple test.} [
        id-prefix: "id-prefix"
    ]
]
[
    filter-html/with {このほんはだれのほん？} [
        emit-utf8: yes
    ]
]
[
    filter-html/with {このほんはだれのほん？} [
        emit-utf8: no
    ]
]
[

    filter-html/with {<a href="http://www.qtask.com/quilt.fcgi/report">Reports</a> <a href="http://www.other.com/">Other</a>} [
        filter-uris: func [uri] [
            if system/words/all [
                uri/tag-name = "a" uri/attribute-name = 'href
                uri/scheme = "http" uri/host = "www.qtask.com"
                not empty? uri/path uri/path/1 = "quilt.fcgi"
            ] [
                if 1 < length? uri/path [
                    uri/fragment: uri/path/2
                    clear next uri/path
                ]
                uri
            ]
        ]
    ]
]
