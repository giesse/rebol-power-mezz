<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content="REBOL" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <title>Better HTTP</title>

<style type="text/css">
/*<![CDATA[*/
html, body, p, li {font-family: Georgia, Times New Roman, serif; text-align: justify;}
.code, .code p {font-family: Trebuchet MS, Arial, Helvetica, sans-serif;}
.code .string, .code .tag, .code .issue {font-family: Lucida Console, Courier New, Courier, fixed;}
.code .word, .code .set-word, .code .lit-word, .code .get-word, .code .refinement {font-style: italic;}
.code .key {font-style: normal; font-weight: bold;}
.code .function {font-weight: bold; font-style: normal;}
.code .ref a {text-decoration: none; color: black;}
.code .ref a:hover {text-decoration: underline; color: blue;}
.code .issue, .code .tag, .code .datatype {color: green;}
.code .datatype {font-style: normal;}
.code .url, .code .file, .code .refinement, .code .lit-word {color: brown;}
.code .integer, .code .decimal, .code .tuple, .code .pair {color: blue;}
.code .comment {color: gray;}
div.code {margin-left: 95pt;}
div.code p.sectdef {font-style: normal; margin: 0 0 0 -30pt;}
div.code p {margin: 0;}
div.code span.tab {padding-left: .75cm; border-left: dotted thin #CCCCCC;}
div.code span.directive {background-color: #F0FFF0; border: dotted thin black;}
#header {margin: 34pt 140pt 140pt 140pt; padding: 0;}
#title {text-align: center; margin: 0 0 34pt 0;}
#author {text-align: center; margin: 13pt 0 0 0; font-size: 13pt;}
#dateversion {text-align: center; margin: 0 0 24pt 0; font-size: 12pt;}
#purpose {text-align: justify; font-style: italic;}
#license {font-size: 7pt; color: gray; margin: 2pt 10pt 2pt 10pt; width: 200pt; float: right; white-space: pre;}
#history {width: 60%; font-size: 10pt; margin-left: auto; margin-right: auto;}
#history thead tr {background-color: #E0E0E0;}
#history td.date {text-align: right;}
#history td.version {text-align: center;}
#history td.desc {width: 100%; text-align: justify;}
#history td.name {text-align: left;}
#toc {margin: 70pt;}
#toc li {list-style: none;}
.section {margin: 70pt 70pt 70pt 100pt;}
.section h2, .section h3 {margin-left: -30pt;}
pre {font-family: Lucida Console; overflow: scroll;}
.center {margin-left: auto; margin-right: auto; text-align: center;}
span.bra {font-family: Arial Unicode MS;}
div.note {margin: 3pt; margin-bottom: 14pt; padding: 0 12pt 6pt 12pt; background-color: #E0E0E0;}
div.note h2 {
    margin: 0 -12pt 12pt -12pt;
    padding: 5pt;
    text-align: center;
    background-color: #606060;
    color: white;
    font-size: 14pt;
}
div.image {text-align: center;}
div.image img {padding: 10px; border: dashed thin black;}
/*]]>*/
</style>
</head>

<body>
    <div id="header"><h1 id="title">Better HTTP</h1><h2 id="author">Gabriele Santilli</h2><h2 id="dateversion">1.0.0</h2><p id="purpose">
        This program replaces the HTTP protocol scheme with a better
        implementation that supports HTTP/1.1 and chunked encoding.
    </p><div id="license">
        =================================
        A message from Silent Software about this source code:

        We have selected the MIT license because it is the closest “standard”
        license to our intent.  If we had our way, we would declare this source
        as public domain, with absolutely no strings attached, not even the
        string that says you have to have strings.  We want to help people, so
        please feel free to contact us if you have questions.
         

        (you only need to include the standard license text below in your
        homage to this source code)
        =================================

        Copyright 2012 Silent Software, Inc.

        Permission is hereby granted, free of charge, to any person obtaining a
        copy of this software and associated documentation files (the
        "Software"), to deal in the Software without restriction, including
        without limitation the rights to use, copy, modify, merge, publish,
        distribute, sublicense, and/or sell copies of the Software, and to
        permit persons to whom the Software is furnished to do so, subject to
        the following conditions:

        The above copyright notice and this permission notice shall be included
        in all copies or substantial portions of the Software.

        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
        OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
        MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
        IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
        CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
        TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
        SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
    </div></div><div id="toc"><h2>Contents:</h2><ul><li><a href="#section-1">1. Introduction</a></li><li><a href="#section-2">2. Overview</a></li><li><a href="#section-3">3. Port handler functions</a></li><ul><li><a href="#section-3.1">3.1 The <span class="code"><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span></span> handler</a></li><li><a href="#section-3.2">3.2 The <span class="code"><span class="word key"title="QUERY target /clear">query</span></span> handler</a></li><li><a href="#section-3.3">3.3 The <span class="code"><span class="word key"title="CLOSE port">close</span></span> handler</a></li><li><a href="#section-3.4">3.4 The <span class="code"><span class="word key"title="READ source /binary /string /direct /no-wait /lines /part size /with end-of-line /mode args /custom params /skip length">read</span></span> handler</a></li></ul><li><a href="#section-4">4. Support functions</a></li></ul></div><div class="section"><h2 id="section-1">1. Introduction</h2><p>In REBOL, a <em>scheme</em> is a set of definitions and functions that handle the
operations of a kind of port. This scheme handles HTTP ports, allowing access
to resources served via HTTP. Version 1.1 of the HTTP protocol is supported
(although some features are not yet implemented at this point).</p></div><div class="section"><h2 id="section-2">2. Overview</h2><p>The scheme is defined by using the <span class="code"><span class="word">Root-Protocol</span></span> object and the <span class="code"><span class="word">net-install</span></span>
function from <span class="code"><span class="word">net-utils</span></span>.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Overview<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="MAKE type spec">make</span> <span class="word">Root-Protocol</span> [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3">Port handler functions</a><span class="bra">&#9002;</span></span><br /><br /><span class="tab">&nbsp;</span><span class="path"><span class="word">net-utils</span>/<span class="word">net-install</span></span> <span class="word">HTTP</span> <span class="word">self</span> <span class="integer">80</span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word">net-utils</span>/<span class="word">net-install</span></span> <span class="word">HTTPS</span> <span class="word">self</span> <span class="integer">443</span><br />]<br /><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-4">Support functions</a><span class="bra">&#9002;</span></span></p></div></div><div class="section"><h2 id="section-3">3. Port handler functions</h2><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Port handler functions<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">open:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span>] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3.1">The <span class="code"><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span></span> handler</a><span class="bra">&#9002;</span></span><br />]<br /><br /><span class="set-word">query:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span>] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3.2">The <span class="code"><span class="word key"title="QUERY target /clear">query</span></span> handler</a><span class="bra">&#9002;</span></span><br />]<br /><br /><span class="set-word">close:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span>] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3.3">The <span class="code"><span class="word key"title="CLOSE port">close</span></span> handler</a><span class="bra">&#9002;</span></span><br />]<br /><br /><span class="set-word">read:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span> <span class="word">data</span> <span class="refinement">/local</span> <span class="word">result</span> <span class="word">desired</span> <span class="word">chunk-size</span>] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3.4">The <span class="code"><span class="word key"title="READ source /binary /string /direct /no-wait /lines /part size /with end-of-line /mode args /custom params /skip length">read</span></span> handler</a><span class="bra">&#9002;</span></span><br />]</p></div><h3 id="section-3.1">3.1 The <span class="code"><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span></span> handler</h3><p>The <span class="code"><span class="path"><span class="word">port</span>/<span class="word">locals</span></span></span> object keeps track of data relative to the request and the
response.</p><dl><dt><span class="code"><span class="word">method</span></span></dt><dd>HTTP request method (as a word);
<dd><dt><span class="code"><span class="word">headers</span></span></dt><dd>additional HTTP headers to send;
<dd><dt><span class="code"><span class="word">content</span></span></dt><dd>HTTP request content;
<dd><dt><span class="code"><span class="word">response-line</span></span></dt><dd>HTTP response line (string!);
<dd><dt><span class="code"><span class="word">response-parsed</span></span></dt><dd>parsed response line (one of <span class="code"><span class="lit-word">'ok</span></span>, <span class="code"><span class="lit-word">'redirect</span></span>,
<span class="code"><span class="lit-word">'see-other</span></span>, <span class="code"><span class="lit-word">'unauthorized</span></span>, <span class="code"><span class="lit-word">'client-error</span></span>, <span class="code"><span class="lit-word">'server-error</span></span>, <span class="code"><span class="lit-word">'proxy-auth</span></span>,
<span class="code"><span class="lit-word">'not-modified</span></span>, <span class="code"><span class="lit-word">'use-proxy</span></span>, <span class="code"><span class="lit-word">'no-content</span></span>, <span class="code"><span class="lit-word">'info</span></span> or
<span class="code"><span class="lit-word">'version-not-supported</span></span>);
<dd><dt><span class="code"><span class="word">response-headers</span></span></dt><dd>HTTP response headers (object!).
<dd></dl><p>The method, headers and content can be specified using the <span class="code"><span class="refinement">/custom</span></span> refinement
(which sets <span class="code"><span class="path"><span class="word">port</span>/<span class="word">state</span>/<span class="word">custom</span></span></span>). (Otherwise, a GET request is done by
default.)</p><p>In the block passed to <span class="code"><span class="refinement">/custom</span></span> you can specify the HTTP method (as a <span class="code"><span class="word datatype"title="">word!</span></span>)
for the request (GET by default, or if there is some content the default is
POST), any additional headers (as a <span class="code"><span class="word datatype"title="">block!</span></span>, gets evaluated to an object) and
the content for the request (<span class="code"><span class="word datatype"title="">any-string!</span></span>); the default Content-Type if not
specified is <span class="code"><span class="string">"application/x-www-form-urlencoded"</span></span>. See <span class="code"><span class="word">parse-custom-data</span></span> for
more details.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>The <span class="code"><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span></span> handler<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-path">port/locals:</span> <span class="word key"title="CONTEXT blk">context</span> [<br /><span class="tab">&nbsp;</span><span class="set-word">method:</span> <span class="lit-word">'GET</span><br /><span class="tab">&nbsp;</span><span class="set-word">headers:</span> []<br /><span class="tab">&nbsp;</span><span class="set-word">content:</span> <span class="word">none</span><br /><span class="tab">&nbsp;</span><span class="set-word">response-line:</span> <span class="word">none</span><br /><span class="tab">&nbsp;</span><span class="set-word">response-parsed:</span> <span class="word">none</span><br /><span class="tab">&nbsp;</span><span class="set-word">response-headers:</span> <span class="word">none</span><br /><span class="tab">&nbsp;</span><span class="set-word">chunked?:</span> <span class="word">no</span><br /><span class="tab">&nbsp;</span><span class="set-word">chunked-buffer:</span> <span class="word">none</span><br />]<br /><span class="word">parse-custom-data</span> <span class="word">port</span><br /><span class="word">open-sub-port</span> <span class="word">port</span><br /><span class="word">do-request</span> <span class="word">port</span><br /><span class="word">parse-response</span> <span class="word">port</span><br /><span class="set-path">port/size:</span> <span class="word key"title="ANY block">any</span> [<span class="word key"title="ATTEMPT value">attempt</span> [<span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">integer!</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span>/<span class="word">Content-Length</span></span>] <span class="integer">0</span>]<br /><span class="set-path">port/date:</span> <span class="word key"title="ATTEMPT value">attempt</span> [<span class="word key"title="PARSE-HEADER-DATE data">parse-header-date</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span>/<span class="word">Last-Modified</span></span>]<br /><span class="set-path">port/status:</span> <span class="lit-word">'file</span></p></div><h3 id="section-3.2">3.2 The <span class="code"><span class="word key"title="QUERY target /clear">query</span></span> handler</h3><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>The <span class="code"><span class="word key"title="QUERY target /clear">query</span></span> handler<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="NOT value">not</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span></span> [<br /><span class="tab">&nbsp;</span><span class="set-path">port/state/custom:</span> [<span class="word key"title="HEAD series">HEAD</span>]<br /><span class="tab">&nbsp;</span><span class="comment">; these are the local open and close functions</span><br /><span class="tab">&nbsp;</span><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span> <span class="word">port</span><br /><span class="tab">&nbsp;</span><span class="word key"title="ATTEMPT value">attempt</span> [<span class="word key"title="CLOSE port">close</span> <span class="word">port</span>]<br />]<br /><span class="word key"title="REDUCE value /only words">reduce</span> [<br /><span class="tab">&nbsp;</span><span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-parsed</span></span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word">port</span>/<span class="word">size</span></span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span>/<span class="word">content-type</span></span><br />]</p></div><h3 id="section-3.3">3.3 The <span class="code"><span class="word key"title="CLOSE port">close</span></span> handler</h3><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>The <span class="code"><span class="word key"title="CLOSE port">close</span></span> handler<span class="bra">&#9002;</span> &#8801;</p><p><span class="word">close-sub-port</span> <span class="word">port</span></p></div><h3 id="section-3.4">3.4 The <span class="code"><span class="word key"title="READ source /binary /string /direct /no-wait /lines /part size /with end-of-line /mode args /custom params /skip length">read</span></span> handler</h3><p>This is a low level handler that is called by the REBOL buffer layer (which
takes care of converting line terminators, and so on).</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>The <span class="code"><span class="word key"title="READ source /binary /string /direct /no-wait /lines /part size /with end-of-line /mode args /custom params /skip length">read</span></span> handler<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked?</span></span> [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-3.4.1">Handle chunked transfer encoding</a><span class="bra">&#9002;</span></span><br />] [<br /><span class="tab">&nbsp;</span><span class="word key"title="READ-IO port buffer length">read-io</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="word">data</span> <span class="path"><span class="word">port</span>/<span class="word">state</span>/<span class="word">num</span></span><br />]</p></div><h4 id="section-3.4.1">3.4.1 Handle chunked transfer encoding</h4><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Handle chunked transfer encoding<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">desired:</span> <span class="path"><span class="word">port</span>/<span class="word">state</span>/<span class="word">num</span></span><br /><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span> [<br /><span class="tab">&nbsp;</span><span class="set-word">desired:</span> <span class="word key"title="MIN value1 value2">min</span> <span class="word">desired</span> <span class="word key"title="LENGTH? series">length?</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="INSERT series value /part range /only /dup count">insert</span>/<span class="word">part</span></span> <span class="word key"title="TAIL series">tail</span> <span class="word">data</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span> <span class="word">desired</span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="REMOVE series /part range">remove</span>/<span class="word">part</span></span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span> <span class="word">desired</span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="EMPTY? series">empty?</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span> [<span class="set-path">port/locals/chunked-buffer:</span> <span class="word">none</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="RETURN value">return</span> <span class="word">desired</span><br />]<br /><span class="set-word">chunk-size:</span> <span class="word key"title="PICK series index">pick</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="integer">1</span><br /><span class="path"><span class="word key"title="PARSE input rules /all /case">parse</span>/<span class="word key"title="ALL block">all</span></span> <span class="word">chunk-size</span> [<span class="word">some</span> <span class="word">hexdigit</span> <span class="word">|</span> (<span class="word key"title="NET-ERROR info">net-error</span> [<span class="word">access</span> <span class="word">protocol</span> <span class="string">"Invalid chunked encoding"</span>])]<br /><span class="set-word">chunk-size:</span> <span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">integer!</span> <span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">issue!</span> <span class="word">chunk-size</span><br /><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word">chunk-size</span> <span class="word key"title="= value1 value2">=</span> <span class="integer">0</span> [<br /><span class="tab">&nbsp;</span><span class="comment">; ignore trailer for now</span><br /><span class="tab">&nbsp;</span><span class="word key"title="WHILE cond-block body-block">while</span> [<span class="string">""</span> <span class="word key"title="&lt;&gt; value1 value2">&lt;&gt;</span> <span class="word key"title="PICK series index">pick</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="integer">1</span>] []<br /><span class="tab">&nbsp;</span><span class="integer">0</span><br />] [<br /><span class="tab">&nbsp;</span><span class="set-word">result:</span> <span class="word key"title="READ-IO port buffer length">read-io</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="word">data</span> <span class="word key"title="MIN value1 value2">min</span> <span class="word">desired</span> <span class="word">chunk-size</span><br /><span class="tab">&nbsp;</span><span class="set-word">chunk-size:</span> <span class="word">chunk-size</span> <span class="word key"title="- value1 value2">-</span> <span class="word">result</span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">chunk-size</span> <span class="word key"title="&gt; value1 value2">&gt;</span> <span class="integer">0</span> [<span class="set-path">port/locals/chunked-buffer:</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">binary!</span> <span class="word">chunk-size</span> <span class="word key"title="+ value1 value2">+</span> <span class="integer">10</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="WHILE cond-block body-block">while</span> [<span class="word">chunk-size</span> <span class="word key"title="&amp;gt; value1 value2">&gt;</span> <span class="integer">0</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">chunk-size:</span> <span class="word">chunk-size</span> <span class="word key"title="- value1 value2">-</span> <span class="word key"title="READ-IO port buffer length">read-io</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">chunked-buffer</span></span> <span class="word">chunk-size</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word">result</span><br />]</p></div></div><div class="section"><h2 id="section-4">4. Support functions</h2><p><span class="code"><span class="word">open-sub-port</span></span> takes care of opening the TCP (or SSL) connection to the HTTP
server.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Support functions<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">open-sub-port:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span> <span class="refinement">/local</span> <span class="word">sub-protocol</span> <span class="word">secure?</span>] [<br /><span class="tab">&nbsp;</span><span class="set-word">sub-protocol:</span> <span class="word key"title="EITHER condition true-block false-block">either</span> <span class="path"><span class="word">port</span>/<span class="word">scheme</span></span> <span class="word key"title="= value1 value2">=</span> <span class="lit-word">'https</span> [<span class="set-word">secure?:</span> <span class="word">yes</span> [<span class="lit-word">'ssl</span>]] [[<span class="lit-word">'tcp</span>]]<br /><span class="tab">&nbsp;</span><span class="set-path">port/sub-port:</span> <span class="path"><span class="word key"title="OPEN spec /binary /string /direct /seek /new /read /write /no-wait /lines /with end-of-line /allow access /mode args /custom params /skip length">open</span>/<span class="word">lines</span></span> <span class="word key"title="COMPOSE value /deep /only">compose</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">scheme:</span> (<span class="word">sub-protocol</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">host:</span> <span class="path"><span class="word">port</span>/<span class="word">host</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">port-id:</span> <span class="path"><span class="word">port</span>/<span class="word">port-id</span></span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-path">port/sub-port/timeout:</span> <span class="path"><span class="word">port</span>/<span class="word">timeout</span></span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">secure?</span> [<span class="word key"title="SET-MODES target modes">set-modes</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> [<span class="set-word">secure:</span> <span class="word">true</span>]]<br />]<br /><span class="set-word">close-sub-port:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span>] [<br /><span class="tab">&nbsp;</span><span class="word key"title="CLOSE port">close</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span><br />]</p></div><p>The <span class="code"><span class="word">do-request</span></span> function makes the HTTP request to the server.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Support functions<span class="bra">&#9002;</span> +&#8801;</p><p><span class="set-word">do-request:</span> <span class="word key"title="FUNC spec body">func</span> [<br /><span class="tab">&nbsp;</span><span class="string">"Perform an HTTP request"</span><br /><span class="tab">&nbsp;</span><span class="word">port</span> [<span class="word datatype"title="">port!</span>]<br /><br /><span class="tab">&nbsp;</span><span class="refinement">/local</span> <span class="word">headers</span> <span class="word">target</span><br />] [<br /><span class="tab">&nbsp;</span><span class="set-word">headers:</span> <span class="word key"title="MAKE type spec">make</span> <span class="word key"title="CONTEXT blk">context</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">Accept:</span> <span class="string">"*/*"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">Accept-Charset:</span> <span class="string">"utf-8"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">Host:</span> <span class="word key"title="EITHER condition true-block false-block">either</span> <span class="path"><span class="word">port</span>/<span class="word">port-id</span></span> <span class="word key"title="&amp;lt;&amp;gt; value1 value2">&lt;&gt;</span> <span class="word key"title="EITHER condition true-block false-block">either</span> <span class="path"><span class="word">port</span>/<span class="word">scheme</span></span> <span class="word key"title="= value1 value2">=</span> <span class="lit-word">'https</span> [<span class="integer">443</span>] [<span class="integer">80</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="REJOIN block">rejoin</span> [<span class="word key"title="FORM value">form</span> <span class="path"><span class="word">port</span>/<span class="word">host</span></span> <span class="char">#":"</span> <span class="path"><span class="word">port</span>/<span class="word">port-id</span></span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="FORM value">form</span> <span class="path"><span class="word">port</span>/<span class="word">host</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">User-Agent:</span> <span class="string">"REBOL"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">Connection:</span> <span class="string">"close"</span><br /><span class="tab">&nbsp;</span>] <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">headers</span></span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">content</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">headers:</span> <span class="word key"title="MAKE type spec">make</span> <span class="word">headers</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">Content-Length:</span> <span class="word key"title="FORM value">form</span> <span class="word key"title="LENGTH? series">length?</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">content</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-word">headers:</span> <span class="word key"title="THIRD series">third</span> <span class="word">headers</span><br /><span class="tab">&nbsp;</span><span class="set-word">target:</span> <span class="word key"title="COPY value /part range /deep">copy</span> <span class="file">%/</span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word key"title="PATH value selector">path</span></span> [<span class="word key"title="APPEND series value /only">append</span> <span class="word">target</span> <span class="path"><span class="word">port</span>/<span class="word key"title="PATH value selector">path</span></span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word">target</span></span> [<span class="word key"title="APPEND series value /only">append</span> <span class="word">target</span> <span class="path"><span class="word">port</span>/<span class="word">target</span></span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="INSERT series value /part range /only /dup count">insert</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="word key"title="REJOIN block">rejoin</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="UPPERCASE string /part range">uppercase</span> <span class="word key"title="FORM value">form</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">method</span></span> <span class="char">#" "</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; needs better escaping!!</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="NEXT series">next</span> <span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">target</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">" HTTP/1.1"</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="FOREACH 'word data body">foreach</span> [<span class="word">word</span> <span class="word">string</span>] <span class="word">headers</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="INSERT series value /part range /only /dup count">insert</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="word key"title="REJOIN block">rejoin</span> [<span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">word</span> <span class="char">#" "</span> <span class="word">string</span>]<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="INSERT series value /part range /only /dup count">insert</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="string">""</span><br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">content</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="WRITE-IO port buffer length">write-io</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">content</span></span> <span class="word key"title="LENGTH? series">length?</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">content</span></span><br /><span class="tab">&nbsp;</span>]<br />]</p></div><p>The <span class="code"><span class="word">parse-custom-data</span></span> function parses the block passed to the <span class="code"><span class="refinement">/custom</span></span>
refinement and extracts the request method, request headers and request
content. The values in the port object are set accordingly so that they can be
used later on by the <span class="code"><span class="word">do-request</span></span> function.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Support functions<span class="bra">&#9002;</span> +&#8801;</p><p><span class="set-word">parse-custom-data:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span> <span class="refinement">/local</span> <span class="word">method</span> <span class="word">headers</span> <span class="word">content</span>] [<br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="BLOCK? value">block?</span> <span class="path"><span class="word">port</span>/<span class="word">state</span>/<span class="word">custom</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="PARSE input rules /all /case">parse</span> <span class="path"><span class="word">port</span>/<span class="word">state</span>/<span class="word">custom</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">opt</span> [<span class="word key"title="SET word value /any /pad">set</span> <span class="word">method</span> <span class="word datatype"title="">word!</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">opt</span> [<span class="word key"title="SET word value /any /pad">set</span> <span class="word">headers</span> <span class="word datatype"title="">block!</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">opt</span> [<span class="word key"title="SET word value /any /pad">set</span> <span class="word">content</span> <span class="word datatype"title="">any-string!</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">content</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="word">method</span> [<span class="set-word">method:</span> <span class="lit-word">'POST</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word">headers</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="word key"title="FIND series value /part range /only /case /any /with wild /skip size /match /tail /last /reverse">find</span> <span class="word">headers</span> [<span class="set-word">Content-Type:</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="APPEND series value /only">append</span> <span class="word">headers</span> [<span class="set-word">Content-Type:</span> <span class="string">"application/x-www-form-urlencoded"</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">headers:</span> [<span class="set-word">Content-Type:</span> <span class="string">"application/x-www-form-urlencoded"</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">method</span> [<span class="set-path">port/locals/method:</span> <span class="word">method</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">headers</span> [<span class="set-path">port/locals/headers:</span> <span class="word">headers</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">content</span> [<span class="set-path">port/locals/content:</span> <span class="word">content</span>]<br /><span class="tab">&nbsp;</span>]<br />]</p></div><p><span class="code"><span class="word">parse-response</span></span> waits for the server response, and parses it.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Support functions<span class="bra">&#9002;</span> +&#8801;</p><p><span class="set-word">parse-response:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">port</span> <span class="refinement">/local</span> <span class="word">line</span> <span class="word">header</span>] [<br /><span class="tab">&nbsp;</span><span class="set-path">port/locals/response-line:</span> <span class="word key"title="PICK series index">pick</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="integer">1</span><br /><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="PARSE input rules /all /case">parse</span>/<span class="word key"title="ALL block">all</span></span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-line</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"HTTP/1."</span> [<span class="char">#"0"</span> <span class="word">|</span> <span class="char">#"1"</span>] <span class="word">some</span> <span class="char">#" "</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="char">#"1"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'info</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="char">#"2"</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>[<span class="string">"04"</span> <span class="word">|</span> <span class="string">"05"</span>] (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'no-content</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>(<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'ok</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="char">#"3"</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"03"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'see-other</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"04"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'not-modified</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"05"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'use-proxy</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>(<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'redirect</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="char">#"4"</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"01"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'unauthorized</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="string">"07"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'proxy-auth</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>(<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'client-error</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="char">#"5"</span> (<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'server-error</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>(<span class="set-path">port/locals/response-parsed:</span> <span class="lit-word">'version-not-supported</span>)<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-path">port/locals/response-headers:</span> <span class="word key"title="COPY value /part range /deep">copy</span> []<br /><span class="tab">&nbsp;</span><span class="word key"title="WHILE cond-block body-block">while</span> [<span class="string">""</span> <span class="word key"title="&amp;amp;lt;&amp;amp;gt; value1 value2">&lt;&gt;</span> <span class="set-word">line:</span> <span class="word key"title="PICK series index">pick</span> <span class="path"><span class="word">port</span>/<span class="word">sub-port</span></span> <span class="integer">1</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="PARSE input rules /all /case">parse</span>/<span class="word key"title="ALL block">all</span></span> <span class="word">line</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; continuation of previous header line</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">some</span> <span class="word">space-char</span> <span class="set-word">line:</span> (<span class="word key"title="APPEND series value /only">append</span> <span class="word key"title="LAST series">last</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span></span> <span class="word">line</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="COPY value /part range /deep">copy</span> <span class="word">header</span> <span class="word">name</span> <span class="char">#":"</span> <span class="word key"title="ANY block">any</span> <span class="word">space-char</span> <span class="word key"title="COPY value /part range /deep">copy</span> <span class="word">line</span> <span class="word key"title="TO type spec">to</span> <span class="word">end</span> (<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="APPEND series value /only">append</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span></span> <span class="word key"title="REDUCE value /only words">reduce</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">set-word!</span> <span class="word">header</span> <span class="word">line</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-path">port/locals/response-headers:</span> <span class="path"><span class="word key"title="CONSTRUCT block /with object">construct</span>/<span class="word">with</span></span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span></span> <span class="word">http-response-headers</span><br /><span class="tab">&nbsp;</span><span class="word key"title="SWITCH value cases /default case">switch</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-parsed</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">ok</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-headers</span>/<span class="word">transfer-encoding</span></span> <span class="word key"title="= value1 value2">=</span> <span class="string">"chunked"</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-path">port/locals/chunked?:</span> <span class="word">yes</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">redirect</span> <span class="word">see-other</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="NET-ERROR info">net-error</span> <span class="word key"title="REDUCE value /only words">reduce</span> [<span class="lit-word">'access</span> <span class="lit-word">'protocol</span> <span class="string">"Redirects not supported yet"</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">unauthorized</span> <span class="word">client-error</span> <span class="word">server-error</span> <span class="word">proxy-auth</span> <span class="word">use-proxy</span> <span class="word">proxy-auth</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="NET-ERROR info">net-error</span> <span class="word key"title="REDUCE value /only words">reduce</span> [<span class="lit-word">'access</span> <span class="lit-word">'protocol</span> <span class="path"><span class="word">port</span>/<span class="word">locals</span>/<span class="word">response-line</span></span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">info</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; we just ignore the informational response, and try to parse the following response</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">parse-response</span> <span class="word">port</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">version-not-supported</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="NET-ERROR info">net-error</span> <span class="word key"title="REDUCE value /only words">reduce</span> [<span class="lit-word">'access</span> <span class="lit-word">'protocol</span> <span class="string">"HTTP version not supported"</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span>]<br />]<br /><span class="set-word">http-response-headers:</span> <span class="word key"title="CONTEXT blk">context</span> [<br /><span class="tab">&nbsp;</span><span class="set-word">Content-Type:</span><br /><span class="tab">&nbsp;</span><span class="set-word">Content-Length:</span><br /><span class="tab">&nbsp;</span><span class="set-word">Transfer-Encoding:</span><br /><span class="tab">&nbsp;</span><span class="set-word">Last-Modified:</span> <span class="word">none</span><br />]<br /><span class="set-word">parse-header-date:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">date</span>] [<br /><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="PARSE input rules /all /case">parse</span>/<span class="word key"title="ALL block">all</span></span> <span class="word">date</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">opt</span> [[<span class="string">"Mon"</span> <span class="word">|</span> <span class="string">"Tue"</span> <span class="word">|</span> <span class="string">"Wed"</span> <span class="word">|</span> <span class="string">"Thu"</span> <span class="word">|</span> <span class="string">"Fri"</span> <span class="word">|</span> <span class="string">"Sat"</span> <span class="word">|</span> <span class="string">"Sun"</span>] <span class="char">#","</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="ANY block">any</span> <span class="word">space-char</span> <span class="set-word">date:</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">date!</span> <span class="word">date</span><br />]</p></div></div>
    <div id="footer"><p><a href="http://www.rebol.com/">MakeDoc3 by REBOL</a> - 2-Sep-2018</p></div>
</body>
</html>
