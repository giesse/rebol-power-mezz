<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta name="generator" content="REBOL" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <title>Modules for REBOL 2</title>

<style type="text/css">
/*<![CDATA[*/
html, body, p, li {font-family: Georgia, Times New Roman, serif; text-align: justify;}
.code, .code p {font-family: Trebuchet MS, Arial, Helvetica, sans-serif;}
.code .string, .code .tag, .code .issue {font-family: Lucida Console, Courier New, Courier, fixed;}
.code .word, .code .set-word, .code .lit-word, .code .get-word, .code .refinement {font-style: italic;}
.code .key {font-style: normal; font-weight: bold;}
.code .function {font-weight: bold; font-style: normal;}
.code .ref a {text-decoration: none; color: black;}
.code .ref a:hover {text-decoration: underline; color: blue;}
.code .issue, .code .tag, .code .datatype {color: green;}
.code .datatype {font-style: normal;}
.code .url, .code .file, .code .refinement, .code .lit-word {color: brown;}
.code .integer, .code .decimal, .code .tuple, .code .pair {color: blue;}
.code .comment {color: gray;}
div.code {margin-left: 95pt;}
div.code p.sectdef {font-style: normal; margin: 0 0 0 -30pt;}
div.code p {margin: 0;}
div.code span.tab {padding-left: .75cm; border-left: dotted thin #CCCCCC;}
div.code span.directive {background-color: #F0FFF0; border: dotted thin black;}
#header {margin: 34pt 140pt 140pt 140pt; padding: 0;}
#title {text-align: center; margin: 0 0 34pt 0;}
#author {text-align: center; margin: 13pt 0 0 0; font-size: 13pt;}
#dateversion {text-align: center; margin: 0 0 24pt 0; font-size: 12pt;}
#purpose {text-align: justify; font-style: italic;}
#license {font-size: 7pt; color: gray; margin: 2pt 10pt 2pt 10pt; width: 200pt; float: right; white-space: pre;}
#history {width: 60%; font-size: 10pt; margin-left: auto; margin-right: auto;}
#history thead tr {background-color: #E0E0E0;}
#history td.date {text-align: right;}
#history td.version {text-align: center;}
#history td.desc {width: 100%; text-align: justify;}
#history td.name {text-align: left;}
#toc {margin: 70pt;}
#toc li {list-style: none;}
.section {margin: 70pt 70pt 70pt 100pt;}
.section h2, .section h3 {margin-left: -30pt;}
pre {font-family: Lucida Console; overflow: scroll;}
.center {margin-left: auto; margin-right: auto; text-align: center;}
span.bra {font-family: Arial Unicode MS;}
div.note {margin: 3pt; margin-bottom: 14pt; padding: 0 12pt 6pt 12pt; background-color: #E0E0E0;}
div.note h2 {
    margin: 0 -12pt 12pt -12pt;
    padding: 5pt;
    text-align: center;
    background-color: #606060;
    color: white;
    font-size: 14pt;
}
div.image {text-align: center;}
div.image img {padding: 10px; border: dashed thin black;}
/*]]>*/
</style>
</head>

<body>
    <div id="header"><h1 id="title">Modules for REBOL 2</h1><h2 id="author">Gabriele Santilli</h2><h2 id="dateversion">1.1.2</h2><p id="purpose">
        Defines the MODULE function, that creates encapsulated "modules" that are isolated
        from the rest of the code. Also defines LOAD-MODULE to automate module loading.
    </p><div id="license">
        =================================
        A message from Qtask about this source code:

        We have selected the MIT license (as of 2010-Jan-1) because
        it is the closest “standard” license to our intent.  If we had our way,
        we would declare this source as public domain, with absolutely no
        strings attached, not even the string that says you have to have
        strings.  We want to help people, so please feel free to contact us
        at API@Qtask.com if you have questions.
         

        (you only need to include the standard license text below in your
        homage to this source code)
        =================================

        Copyright 2009 Qtask, Inc.

        Permission is hereby granted, free of charge, to any person obtaining
        a copy of this software and associated documentation files
        (the "Software"), to deal in the Software without restriction, including
        without limitation the rights to use, copy, modify, merge, publish,
        distribute, sublicense, and/or sell copies of the Software, and to
        permit persons to whom the Software is furnished to do so, subject
        to the following conditions:

        The above copyright notice and this permission notice shall be included
        in all copies or substantial portions of the Software.

        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
        OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
        THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
        OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
        ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
        OTHER DEALINGS IN THE SOFTWARE.
    </div></div><div id="toc"><h2>Contents:</h2><ul><li><a href="#section-1">1. Introduction</a></li><li><a href="#section-2">2. Overview</a></li><li><a href="#section-3">3. Examples</a></li><li><a href="#section-4">4. Definition of the <span class="code"><span class="word">module!</span></span> object prototype</a></li><li><a href="#section-5">5. Create a module based on the given <span class="code"><span class="word">spec</span></span> and <span class="code"><span class="word">body</span></span></a></li><ul><li><a href="#section-5.1">5.1 Create the module object from the <span class="code"><span class="word">spec</span></span></a></li><li><a href="#section-5.2">5.2 <span class="code"><span class="word">module</span></span>'s locals</a></li><li><a href="#section-5.3">5.3 Create the list of local words</a></li><li><a href="#section-5.4">5.4 Check if <span class="code"><span class="word">value</span></span> is a module object</a></li><li><a href="#section-5.5">5.5 Import other modules specified in the <span class="code"><span class="word">spec</span></span></a></li><li><a href="#section-5.6">5.6 Find words that are global or imported from another module, but are being set in the <span class="code"><span class="word">body</span></span></a></li><li><a href="#section-5.7">5.7 Create the local and export contexts and bind the <span class="code"><span class="word">body</span></span> to them</a></li><li><a href="#section-5.8">5.8 Import the values that would otherwise be shielded by the local context</a></li><li><a href="#section-5.9">5.9 <span class="code"><span class="word key"title="DO value /args arg /next">do</span></span> the <span class="code"><span class="word">body</span></span>; return the module object</a></li></ul><li><a href="#section-6">6. Load <span class="code"><span class="word">script</span></span> as a module</a></li><ul><li><a href="#section-6.1">6.1 <span class="code"><span class="word">load-module</span></span>'s locals</a></li></ul><li><a href="#section-7">7. Support functions</a></li><li><a href="#section-8">8. Hiding the support functions from the global context</a></li><li><a href="#section-9">9. How to inspect a module</a></li><li><a href="#section-10">10. Credits</a></li></ul></div><div class="section"><h2 id="section-1">1. Introduction</h2><p>In a larger project with many people contributing to the code, it is useful to provide mechanisms
to better isolate parts of the code from each other, so that mistakes, typos, etc. in some part will
have a smaller chance of affecting the other parts. For this reason, we define here a <span class="code"><span class="word">module</span></span> function
that creates an "isolated" piece of code, that only interacts with the rest of the system according to the
provided specification.</p></div><div class="section"><h2 id="section-2">2. Overview</h2><p>The <span class="code"><span class="word">module!</span></span> object is the prototype for modules; we represent them as objects so that it is possible
to inspect them after creation (see <span class="code"><span class="ref"><span class="bra">&#9001;</span><a href="#section-9">How to inspect a module</a><span class="bra">&#9002;</span></span></span>). The <span class="code"><span class="word">module</span></span> function creates such objects and
does all the magic necessary for the code in the <span class="code"><span class="word">body</span></span> to be isolated from the rest of the system.</p><p>The <span class="code"><span class="word">spec</span></span> argument is a block which can specify the title of the module (<span class="code"><span class="set-word">Title:</span> <span class="string">"Some string"</span></span>), the
description or purpose of the module (<span class="code"><span class="set-word">Purpose:</span> <span class="string">"Some string"</span></span>), and how the module interacts with the rest
of the system. In particular, you can specify whether you want access to the words exported by another
module by <em>importing</em> it with <span class="code"><span class="set-word">Imports:</span> [<span class="word">block</span> <span class="word">of</span> <span class="word">words</span> <span class="word key"title="OR value1 value2">or</span> <span class="word">files</span>]</span> (each word should refer
to a module object; <span class="code"><span class="word datatype"title="">file!</span></span> values are passed to <span class="code"><span class="word">load-module</span></span>, and the resulting module is then imported;
it is possible to use strings or other values in this block to provide comments).
You can also specify which words you want other modules to be able to import from you by <em>exporting</em> them
using <span class="code"><span class="set-word">Exports:</span> [<span class="word">block</span> <span class="word">of</span> <span class="word">words</span>]</span> (you can also use strings or other values in this block
to provide comments about the words you are exporting). It is also possible to use <span class="code"><span class="set-word">Exports:</span> <span class="lit-word">'All</span></span> to
signal that all the module's locals (that is, all the contained <span class="code"><span class="word datatype"title="">set-word!</span></span>'s) should be exported.
Finally, you can allow your module to alter the global
context in a controlled way, by using <span class="code"><span class="set-word">Globals:</span> [<span class="word">block</span> <span class="word">of</span> <span class="word">words</span>]</span> (again, strings are ok
in this block); such words will not be made local to the module.</p><p>The <span class="code"><span class="word">module?</span></span> function returns true if the passed value is a module object.</p><p>See <span class="code"><span class="ref"><span class="bra">&#9001;</span><a href="#section-3">Examples</a><span class="bra">&#9002;</span></span></span> for some examples.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Overview<span class="bra">&#9002;</span> &#8801;</p><p><span class="ref"><span class="bra">&#9001;</span><a href="#section-7">Support functions</a><span class="bra">&#9002;</span></span><br /><br /><span class="set-word">module!:</span> <span class="word key"title="CONTEXT blk">context</span> [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-4">Definition of the <span class="code"><span class="word">module!</span></span> object prototype</a><span class="bra">&#9002;</span></span><br />]<br /><br /><span class="set-word">module:</span> <span class="word key"title="FUNC spec body">func</span> [<br /><span class="tab">&nbsp;</span><span class="string">"Create a new module"</span> [<span class="word key"title="CATCH block /name word">catch</span>]<br /><span class="tab">&nbsp;</span><span class="word">spec</span> [<span class="word datatype"title="">block!</span> <span class="word datatype"title="">object!</span>] <span class="string">{You can set TITLE, PURPOSE, IMPORTS, EXPORTS, GLOBALS}</span><br /><span class="tab">&nbsp;</span><span class="word">body</span> [<span class="word datatype"title="">block!</span>]<br /><br /><span class="tab">&nbsp;</span><span class="refinement">/local</span> <span class="ref"><span class="bra">&#9001;</span><a href="#section-5.2"><span class="code"><span class="word">module</span></span>'s locals</a><span class="bra">&#9002;</span></span><br />] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-5">Create a module based on the given <span class="code"><span class="word">spec</span></span> and <span class="code"><span class="word">body</span></span></a><span class="bra">&#9002;</span></span><br />]<br /><br /><span class="set-word">module?:</span> <span class="word key"title="FUNC spec body">func</span> [<br /><span class="tab">&nbsp;</span><span class="string">"Returns TRUE for module objects"</span><br /><span class="tab">&nbsp;</span><span class="word">value</span> [<span class="word datatype"title="">any-type!</span>]<br />] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.4">Check if <span class="code"><span class="word">value</span></span> is a module object</a><span class="bra">&#9002;</span></span><br />]</p></div><p>We also define <span class="code"><span class="word">load-module</span></span>, that can load a REBOL script as a module based on its header. The header
must have <span class="code"><span class="word">Type</span></span> set to <span class="code"><span class="lit-word">'module</span></span>, and can specify <span class="code"><span class="word">Imports</span></span>, <span class="code"><span class="word">Exports</span></span> and <span class="code"><span class="word">Globals</span></span> with the meanings
given above. Unless the argument is a <span class="code"><span class="word datatype"title="">url!</span></span> or an absolute path, the module is searched for in the search
path (that can be specified using the <span class="code"><span class="refinement">/from</span></span> refinement). Please note that you have to add the current
directory (<span class="code"><span class="file">%./</span></span>) to the search path explicitly if you want to allow the argument to be relative to
the current directory.</p><p><span class="code"><span class="word">load-module</span></span> never loads the same module (identified by its absolute path) twice. Also, since the <span class="code"><span class="word">module</span></span>
function automatically calls <span class="code"><span class="word">load-module</span></span> on the modules to import, this means that when you load a module
all the other modules it depends on are also loaded automatically.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Overview<span class="bra">&#9002;</span> +&#8801;</p><p><span class="set-word">load-module:</span> <span class="word key"title="FUNC spec body">func</span> [<br /><span class="tab">&nbsp;</span><span class="string">"Load a REBOL script as a module"</span> [<span class="word key"title="CATCH block /name word">catch</span>]<br /><span class="tab">&nbsp;</span><span class="word">script</span> [<span class="word datatype"title="">file!</span> <span class="word datatype"title="">url!</span>]<br /><span class="tab">&nbsp;</span><span class="refinement">/from</span> <span class="string">"Add SCRIPT to the search path"</span><br /><br /><span class="tab">&nbsp;</span><span class="refinement">/local</span> <span class="ref"><span class="bra">&#9001;</span><a href="#section-6.1"><span class="code"><span class="word">load-module</span></span>'s locals</a><span class="bra">&#9002;</span></span><br />] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-6">Load <span class="code"><span class="word">script</span></span> as a module</a><span class="bra">&#9002;</span></span><br />]</p></div></div><div class="section"><h2 id="section-3">3. Examples</h2><p>Create a new module:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Examples<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">my-module:</span> <span class="word">module</span> [<br /><span class="tab">&nbsp;</span><span class="set-word">Title:</span> <span class="string">"My module"</span><br /><span class="tab">&nbsp;</span><span class="set-word">Purpose:</span> <span class="string">"This is my module. It is just an example module."</span><br /><span class="tab">&nbsp;</span><span class="set-word">Imports:</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">my-other-module</span> <span class="string">"We use some stuff from my-other-module"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="file">%modules/foo.r</span> <span class="string">{Call LOAD-MODULE on the file, and import the result}</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-word">Exports:</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">f</span> <span class="string">"You can use this"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">g</span> <span class="string">"Be careful with it"</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-word">Globals:</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">a</span> <span class="string">"We set this globally."</span><br /><span class="tab">&nbsp;</span>]<br />] [<br /><span class="tab">&nbsp;</span><span class="set-word">a:</span> <span class="integer">1</span> <span class="comment">; set globally as specified above</span><br /><span class="tab">&nbsp;</span><span class="set-word">b:</span> <span class="integer">2</span> <span class="comment">; local to the module</span><br /><span class="tab">&nbsp;</span><span class="set-word">f:</span> <span class="word key"title="DOES body">does</span> [ <span class="comment">; exported to other modules</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="PRINT value">print</span> <span class="lit-word">'f</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">c:</span> <span class="integer">3</span> <span class="comment">; will also be local to the module</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-word">g:</span> <span class="word key"title="DOES body">does</span> [ <span class="comment">; exported to other modules</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="PRINT value">print</span> <span class="lit-word">'g</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="PRINT value">print</span> <span class="string">"careful!"</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">h</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="set-word">h:</span> <span class="word key"title="DOES body">does</span> [ <span class="comment">; local to this module</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="PRINT value">print</span> <span class="lit-word">'h</span><br /><span class="tab">&nbsp;</span>]<br />]</p></div><p>Set the search path, and load modules relative to it:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Examples<span class="bra">&#9002;</span> +&#8801;</p><p><span class="path"><span class="word">load-module</span>/<span class="word">from</span></span> <span class="file">%my-modules/</span><br /><span class="word">load-module</span> <span class="file">%my-module.r</span></p></div><p>But you can also specify a full path, thus ignoring the search path:</p><div class="code"><p><span class="word">load-module</span> <span class="file">%/path/to/my-module.r</span><br /><span class="word">load-module</span> <span class="url">http://my-modules.com/my-module.r</span></p></div></div><div class="section"><h2 id="section-4">4. Definition of the <span class="code"><span class="word">module!</span></span> object prototype</h2><p>This is the prototype used for module objects. <span class="code"><span class="word">imported</span></span>, <span class="code"><span class="word">exports</span></span> and <span class="code"><span class="word">global</span></span> are the
blocks as they were provided in the spec for the module. (Note that they can be <span class="code"><span class="word">none</span></span> if
they were not specified in the spec.) <span class="code"><span class="word">local-ctx</span></span> and <span class="code"><span class="word">export-ctx</span></span> are the contexts used
by the module, and you should not touch them.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Definition of the <span class="code"><span class="word">module!</span></span> object prototype<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">Type:</span> <span class="lit-word">'module</span><br /><span class="set-word">Title:</span> <span class="string">"Untitled"</span><br /><span class="set-word">Purpose:</span> <span class="string">"Undocumented"</span><br /><span class="set-word">Imports:</span> <span class="set-word">Exports:</span> <span class="set-word">Globals:</span> <span class="word">none</span><br /><span class="set-word">local-ctx:</span> <span class="set-word">export-ctx:</span> <span class="word">none</span></p></div></div><div class="section"><h2 id="section-5">5. Create a module based on the given <span class="code"><span class="word">spec</span></span> and <span class="code"><span class="word">body</span></span></h2><p>These are the steps required to create a module:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Create a module based on the given <span class="code"><span class="word">spec</span></span> and <span class="code"><span class="word">body</span></span><span class="bra">&#9002;</span> &#8801;</p><p><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.1">Create the module object from the <span class="code"><span class="word">spec</span></span></a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.3">Create the list of local words</a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.5">Import other modules specified in the <span class="code"><span class="word">spec</span></span></a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.6">Find words that are global or imported from another module, but are being set in the <span class="code"><span class="word">body</span></span></a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.7">Create the local and export contexts and bind the <span class="code"><span class="word">body</span></span> to them</a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.8">Import the values that would otherwise be shielded by the local context</a><span class="bra">&#9002;</span></span><br /><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.9"><span class="code"><span class="word key"title="DO value /args arg /next">do</span></span> the <span class="code"><span class="word">body</span></span>; return the module object</a><span class="bra">&#9002;</span></span></p></div><h3 id="section-5.1">5.1 Create the module object from the <span class="code"><span class="word">spec</span></span></h3><p>Here we make the <span class="code"><span class="word">result</span></span> module object from the given <span class="code"><span class="word">spec</span></span> block.
We also prepare <span class="code"><span class="word">export-ctx</span></span>, <span class="code"><span class="word">imports'</span></span> and
<span class="code"><span class="word">globals'</span></span> by extracting all the words from <span class="code"><span class="word">exports</span></span>, <span class="code"><span class="word">imports</span></span> and
<span class="code"><span class="word">globals</span></span>.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Create the module object from the <span class="code"><span class="word">spec</span></span><span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">result:</span> <span class="word key"title="MAKE type spec">make</span> <span class="word">module!</span> <span class="word">spec</span><br /><span class="comment">; we can't allow any-word for globals because EXCLUDE (used below)</span><br /><span class="comment">; distinguishes between different types of words</span><br /><span class="word key"title="FOREACH 'word data body">foreach</span> [<span class="word">src</span> <span class="word">dst</span> <span class="word">cond</span>] <span class="word key"title="BIND words known-word /copy">bind</span> [<br /><span class="tab">&nbsp;</span><span class="word">exports</span> <span class="word">export-ctx</span> [<span class="word key"title="NOT value">not</span> <span class="word key"title="WORD? value">word?</span> <span class="get-word">:value</span>]<br /><span class="tab">&nbsp;</span><span class="word">globals</span> <span class="word">globals'</span> [<span class="word key"title="NOT value">not</span> <span class="word key"title="WORD? value">word?</span> <span class="get-word">:value</span>]<br /><span class="tab">&nbsp;</span><span class="word">imports</span> <span class="word">imports'</span> [<span class="word key"title="NOT value">not</span> <span class="word key"title="ANY block">any</span> [<span class="word key"title="ANY-WORD? value">any-word?</span> <span class="get-word">:value</span> <span class="word key"title="FILE? value">file?</span> <span class="get-word">:value</span> <span class="word key"title="URL? value">url?</span> <span class="get-word">:value</span>]]<br />] <span class="word">result</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="lit-word">'All</span> <span class="word key"title="= value1 value2">=</span> <span class="word key"title="GET word /any">get</span> <span class="word">src</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="SET word value /any /pad">set</span> <span class="word">dst</span> <span class="word key"title="UNIQUE set /case /skip size">unique</span> <span class="word key"title="ANY block">any</span> [<span class="word key"title="GET word /any">get</span> <span class="word">src</span> [ ]]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="REMOVE-EACH 'word data body">remove-each</span> <span class="word">value</span> <span class="word key"title="GET word /any">get</span> <span class="word">dst</span> <span class="word">cond</span><br /><span class="tab">&nbsp;</span>]<br />]</p></div><h3 id="section-5.2">5.2 <span class="code"><span class="word">module</span></span>'s locals</h3><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word">module</span></span>'s locals<span class="bra">&#9002;</span> &#8801;</p><p><span class="word">result</span> <span class="word">imports'</span> <span class="word">globals'</span></p></div><h3 id="section-5.3">5.3 Create the list of local words</h3><p>Here we parse the <span class="code"><span class="word">body</span></span> deeply for <span class="code"><span class="word datatype"title="">set-word!</span></span>'s. We list all words that need to be made
local in <span class="code"><span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span></span>, and exclude the words that we want global from them. (Notice
that we don't need to copy the block here, because <span class="code"><span class="word key"title="EXCLUDE set1 set2 /case /skip size">exclude</span></span> will, and we're going to
make a context out of it anyway.) We also handle the case where <span class="code"><span class="set-word">Exports:</span></span> was set to
<span class="code"><span class="lit-word">'All</span></span> here, making the local context empty and putting all words in the export context.</p><p>Notice that we just leave the words in the <span class="code"><span class="word">globals'</span></span> list alone, so they may be bound to
other contexts as well, not just <span class="code"><span class="path"><span class="word">system</span>/<span class="word">words</span></span></span>.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Create the list of local words<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-path">result/local-ctx:</span> <span class="word key"title="CLEAR series">clear</span> []<br /><span class="word key"title="PARSE input rules /all /case">parse</span> <span class="word">body</span> <span class="set-word">rule:</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="ANY block">any</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; need to word! here because EXCLUDE (used below)</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; distinguishes between different types of words</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="SET word value /any /pad">set</span> <span class="word">word</span> <span class="word datatype"title="">set-word!</span> (<span class="word key"title="APPEND series value /only">append</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> <span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">word!</span> <span class="word">word</span>)<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">into</span> <span class="word">rule</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">|</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="SKIP series offset">skip</span><br /><span class="tab">&nbsp;</span>]<br />]<br /><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="path"><span class="word">result</span>/<span class="word">exports</span></span> <span class="word key"title="= value1 value2">=</span> <span class="lit-word">'All</span> [<br /><span class="tab">&nbsp;</span><span class="set-path">result/export-ctx:</span> <span class="word key"title="EXCLUDE set1 set2 /case /skip size">exclude</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> <span class="word">globals'</span><br /><span class="tab">&nbsp;</span><span class="word key"title="CLEAR series">clear</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span><br />] [<br /><span class="tab">&nbsp;</span><span class="set-path">result/local-ctx:</span> <span class="word key"title="EXCLUDE set1 set2 /case /skip size">exclude</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> <span class="word key"title="APPEND series value /only">append</span> <span class="word key"title="COPY value /part range /deep">copy</span> <span class="word">globals'</span> <span class="path"><span class="word">result</span>/<span class="word">export-ctx</span></span><br />]</p></div><p>We need these additional local words for the function:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word">module</span></span>'s locals<span class="bra">&#9002;</span> +&#8801;</p><p><span class="word">rule</span> <span class="word">word</span></p></div><h3 id="section-5.4">5.4 Check if <span class="code"><span class="word">value</span></span> is a module object</h3><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Check if <span class="code"><span class="word">value</span></span> is a module object<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">logic!</span> <span class="word key"title="ALL block">all</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="OBJECT? value">object?</span> <span class="path"><span class="word key"title="GET word /any">get</span>/<span class="word key"title="ANY block">any</span></span> <span class="lit-word">'value</span><br /><span class="tab">&nbsp;</span><span class="lit-word">'module</span> <span class="word key"title="= value1 value2">=</span> <span class="word key"title="GET word /any">get</span> <span class="word key"title="IN object word">in</span> <span class="word">value</span> <span class="lit-word">'type</span><br />]</p></div><h3 id="section-5.5">5.5 Import other modules specified in the <span class="code"><span class="word">spec</span></span></h3><p>Here we iterate thru all the values in the <span class="code"><span class="word">imports'</span></span> list, call <span class="code"><span class="word">load-module</span></span> or check to make sure that they
refer to a module object, and finally bind the <span class="code"><span class="word">body</span></span> to their export context,
in the order they are specified.</p><p>We are also binding the <span class="code"><span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span></span> list of words to their export context; we are doing
this in preparation for the <span class="code"><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.8">Import the values that would otherwise be shielded by the local context</a><span class="bra">&#9002;</span></span></span> step.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Import other modules specified in the <span class="code"><span class="word">spec</span></span><span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="FOREACH 'word data body">foreach</span> <span class="word">module-name</span> <span class="word">imports'</span> [<br /><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="SET word value /any /pad">set</span>/<span class="word key"title="ANY block">any</span></span> <span class="lit-word">'module</span> <span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word key"title="WORD? value">word?</span> <span class="word">module-name</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="GET word /any">get</span>/<span class="word key"title="ANY block">any</span></span> <span class="word">module-name</span><br /><span class="tab">&nbsp;</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word">load-module</span> <span class="word">module-name</span><br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word">module?</span> <span class="path"><span class="word key"title="GET word /any">get</span>/<span class="word key"title="ANY block">any</span></span> <span class="lit-word">'module</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="OBJECT? value">object?</span> <span class="path"><span class="word">module</span>/<span class="word">export-ctx</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="BIND words known-word /copy">bind</span> <span class="word">body</span> <span class="path"><span class="word">module</span>/<span class="word">export-ctx</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="comment">; used to resolve conflicts</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="BIND words known-word /copy">bind</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> <span class="path"><span class="word">module</span>/<span class="word">export-ctx</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="THROW value /name word">throw</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">error!</span> <span class="word key"title="JOIN value rest">join</span> <span class="string">"Not a module: "</span> <span class="word">module-name</span><br /><span class="tab">&nbsp;</span>]<br />]</p></div><p><span class="code"><span class="word">module</span></span> needs to be made local:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word">module</span></span>'s locals<span class="bra">&#9002;</span> +&#8801;</p><p><span class="word">module</span></p></div><h3 id="section-5.6">5.6 Find words that are global or imported from another module, but are being set in the <span class="code"><span class="word">body</span></span></h3><p>This step is necessary to avoid a problem. Since we make all words that are being set local,
regardless of where they are being set, and regardless of whether we are also importing the
same word from another module, we end up "shielding" access to those words. On one side, we
want this to happen (since we don't want to allow the module to alter a module it is importing,
or the global context), but on the other side we don't want to prevent access to the values
these words refer to.</p><p>A word in <span class="code"><span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span></span> has a value in the following cases:</p><ol><li>it has a value in the global context;</li><li>it has a value in the export context of one of the modules we are importing (this is thanks to the
bind we do in <span class="code"><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.5">Import other modules specified in the <span class="code"><span class="word">spec</span></span></a><span class="bra">&#9002;</span></span></span>).</li></ol><p>We collect such words in the <span class="code"><span class="word">conflicts</span></span> block.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Find words that are global or imported from another module, but are being set in the <span class="code"><span class="word">body</span></span><span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">conflicts:</span> <span class="word key"title="CLEAR series">clear</span> [ ]<br /><span class="word key"title="FOREACH 'word data body">foreach</span> <span class="word">word</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="VALUE? value">value?</span> <span class="word">word</span> [<span class="word key"title="APPEND series value /only">append</span> <span class="word">conflicts</span> <span class="word">word</span>]<br />]</p></div><p><span class="code"><span class="word">conflicts</span></span> needs to be local:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word">module</span></span>'s locals<span class="bra">&#9002;</span> +&#8801;</p><p><span class="word">conflicts</span></p></div><h3 id="section-5.7">5.7 Create the local and export contexts and bind the <span class="code"><span class="word">body</span></span> to them</h3><p>We create the local and export contexts using <span class="code"><span class="word">make-context</span></span>, and bind
the <span class="code"><span class="word">body</span></span> to them.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Create the local and export contexts and bind the <span class="code"><span class="word">body</span></span> to them<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="FOREACH 'word data body">foreach</span> <span class="word">ctx</span> <span class="word key"title="BIND words known-word /copy">bind</span> [<span class="word">local-ctx</span> <span class="word">export-ctx</span>] <span class="word">result</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word key"title="EMPTY? series">empty?</span> <span class="word key"title="GET word /any">get</span> <span class="word">ctx</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="SET word value /any /pad">set</span> <span class="word">ctx</span> <span class="word">none</span><br /><span class="tab">&nbsp;</span>] [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="BIND words known-word /copy">bind</span> <span class="word">body</span> <span class="word key"title="SET word value /any /pad">set</span> <span class="word">ctx</span> <span class="word">make-context</span> <span class="word key"title="GET word /any">get</span> <span class="word">ctx</span><br /><span class="tab">&nbsp;</span>]<br />]</p></div><h3 id="section-5.8">5.8 Import the values that would otherwise be shielded by the local context</h3><p>This step solves the problem we described in <span class="code"><span class="ref"><span class="bra">&#9001;</span><a href="#section-5.6">Find words that are global or imported from another module, but are being set in the <span class="code"><span class="word">body</span></span></a><span class="bra">&#9002;</span></span></span>, by importing the values
in the local context.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Import the values that would otherwise be shielded by the local context<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="FOREACH 'word data body">foreach</span> <span class="word">word</span> <span class="word">conflicts</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="SET word value /any /pad">set</span> <span class="word key"title="IN object word">in</span> <span class="path"><span class="word">result</span>/<span class="word">local-ctx</span></span> <span class="word">word</span> <span class="word key"title="GET word /any">get</span> <span class="word">word</span><br />]</p></div><h3 id="section-5.9">5.9 <span class="code"><span class="word key"title="DO value /args arg /next">do</span></span> the <span class="code"><span class="word">body</span></span>; return the module object</h3><p>Finally, we <span class="code"><span class="word key"title="DO value /args arg /next">do</span></span> the <span class="code"><span class="word">body</span></span>, and return <span class="code"><span class="word">result</span></span>.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word key"title="DO value /args arg /next">do</span></span> the <span class="code"><span class="word">body</span></span>; return the module object<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="DO value /args arg /next">do</span> <span class="word">body</span><br /><span class="word">result</span></p></div></div><div class="section"><h2 id="section-6">6. Load <span class="code"><span class="word">script</span></span> as a module</h2><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Load <span class="code"><span class="word">script</span></span> as a module<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">search-path:</span> [ ]<br /><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word">from</span> [<span class="word key"title="RETURN value">return</span> <span class="word key"title="APPEND series value /only">append</span> <span class="word">search-path</span> <span class="word">script</span>]<br /><span class="word key"title="EITHER condition true-block false-block">either</span> <span class="word key"title="ANY block">any</span> [<span class="word key"title="URL? value">url?</span> <span class="word">script</span> <span class="char">#"/"</span> <span class="word key"title="= value1 value2">=</span> <span class="word key"title="FIRST series">first</span> <span class="word">script</span>] [<br /><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="set-word">loaded:</span> <span class="word key"title="SELECT series value /part range /only /case /any /with wild /skip size">select</span> <span class="word">modules</span> <span class="word">script</span> [<span class="word key"title="RETURN value">return</span> <span class="word">loaded</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="PARSE input rules /all /case">parse</span> <span class="set-word">loaded:</span> <span class="path"><span class="word key"title="LOAD source /header /next /library /markup /all">load</span>/<span class="word">header</span></span> <span class="word">script</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="lit-word">'REBOL</span> <span class="word datatype"title="">block!</span> (<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">loaded:</span> <span class="word key"title="NEXT series">next</span> <span class="word">loaded</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-path">loaded/1:</span> <span class="word key"title="CONSTRUCT block /with object">construct</span> <span class="path"><span class="word">loaded</span>/<span class="integer">1</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>)<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="word">module?</span> <span class="path"><span class="word">loaded</span>/<span class="integer">1</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="THROW value /name word">throw</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">error!</span> <span class="word key"title="REJOIN block">rejoin</span> [<span class="string">"Not a module: "</span> <span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">script</span>]<br /><span class="tab">&nbsp;</span>]<br />] [<br /><span class="tab">&nbsp;</span><span class="set-word">loaded:</span> <span class="word key"title="FOREACH 'word data body">foreach</span> <span class="word key"title="PATH value selector">path</span> <span class="word">search-path</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="set-word">loaded:</span> <span class="word key"title="SELECT series value /part range /only /case /any /with wild /skip size">select</span> <span class="word">modules</span> <span class="path"><span class="word key"title="PATH value selector">path</span>/<span class="get-word">:script</span></span> [<span class="word key"title="RETURN value">return</span> <span class="word">loaded</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="EXISTS? target">exists?</span> <span class="path"><span class="word key"title="PATH value selector">path</span>/<span class="get-word">:script</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">loaded:</span> <span class="path"><span class="word key"title="LOAD source /header /next /library /markup /all">load</span>/<span class="word">header</span></span> <span class="path"><span class="word key"title="PATH value selector">path</span>/<span class="get-word">:script</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="word">module?</span> <span class="path"><span class="word">loaded</span>/<span class="integer">1</span></span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="THROW value /name word">throw</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">error!</span> <span class="word key"title="REJOIN block">rejoin</span> [<span class="string">"Not a module: "</span> <span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">script</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="set-word">script:</span> <span class="path"><span class="word key"title="PATH value selector">path</span>/<span class="get-word">:script</span></span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="path"><span class="word key"title="BREAK /return value">break</span>/<span class="word key"title="RETURN value">return</span></span> <span class="word">loaded</span><br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span>]<br /><span class="tab">&nbsp;</span><span class="word key"title="UNLESS condition block">unless</span> <span class="word">loaded</span> [<br /><span class="tab">&nbsp;</span><span class="tab">&nbsp;</span><span class="word key"title="THROW value /name word">throw</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">error!</span> <span class="word key"title="REJOIN block">rejoin</span> [<span class="string">"Cannot find "</span> <span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">script</span>]<br /><span class="tab">&nbsp;</span>]<br />]<br /><span class="word key"title="IF condition then-block /else else-block">if</span> <span class="word key"title="FIND series value /part range /only /case /any /with wild /skip size /match /tail /last /reverse">find</span> <span class="word">modules</span> <span class="word">script</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="THROW value /name word">throw</span> <span class="word key"title="MAKE type spec">make</span> <span class="word datatype"title="">error!</span> <span class="word key"title="REJOIN block">rejoin</span> [<span class="string">"Loading loop detected: aborted at "</span> <span class="word key"title="MOLD value /only /all /flat">mold</span> <span class="word">script</span>]<br />]<br /><span class="word key"title="REPEND series value /only">repend</span> <span class="word">modules</span> [<span class="word">script</span> <span class="word">none</span>]<br /><span class="word key"title="UNLESS condition block">unless</span> <span class="word key"title="URL? value">url?</span> <span class="word">script</span> [<br /><span class="tab">&nbsp;</span><span class="set-word">save-dir:</span> <span class="word key"title="WHAT-DIR ">what-dir</span><br /><span class="tab">&nbsp;</span><span class="word key"title="CHANGE-DIR dir">change-dir</span> <span class="word key"title="FIRST series">first</span> <span class="word key"title="SPLIT-PATH target">split-path</span> <span class="word">script</span><br />]<br /><span class="set-word">loaded:</span> <span class="word">module</span> <span class="path"><span class="word">loaded</span>/<span class="integer">1</span></span> <span class="word key"title="NEXT series">next</span> <span class="word">loaded</span><br /><span class="word key"title="UNLESS condition block">unless</span> <span class="word key"title="URL? value">url?</span> <span class="word">script</span> [<br /><span class="tab">&nbsp;</span><span class="word key"title="CHANGE-DIR dir">change-dir</span> <span class="word">save-dir</span><br />]<br /><span class="word key"title="POKE value index data">poke</span> <span class="word key"title="FIND series value /part range /only /case /any /with wild /skip size /match /tail /last /reverse">find</span> <span class="word">modules</span> <span class="word">script</span> <span class="integer">2</span> <span class="word">loaded</span><br /><span class="word">loaded</span></p></div><p>List of loaded modules:</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Overview<span class="bra">&#9002;</span> +&#8801;</p><p><span class="set-word">modules:</span> [ ]</p></div><h3 id="section-6.1">6.1 <span class="code"><span class="word">load-module</span></span>'s locals</h3><div class="code"><p class="sectdef"><span class="bra">&#9001;</span><span class="code"><span class="word">load-module</span></span>'s locals<span class="bra">&#9002;</span> &#8801;</p><p><span class="word">loaded</span> <span class="word">search-path</span> <span class="word">save-dir</span></p></div></div><div class="section"><h2 id="section-7">7. Support functions</h2><p>The <span class="code"><span class="word">make-context</span></span> function creates a context from a list of words. The context is returned as an object,
but notice that it has no <span class="code"><span class="lit-word">'self</span></span> word.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Support functions<span class="bra">&#9002;</span> &#8801;</p><p><span class="set-word">make-context:</span> <span class="word key"title="FUNC spec body">func</span> [<span class="word">words</span>] [<br /><span class="tab">&nbsp;</span><span class="word key"title="USE words body">use</span> <span class="word">words</span> <span class="word key"title="COMPOSE value /deep /only">compose</span> [<span class="word key"title="BIND? words">bind?</span> (<span class="word key"title="TO type spec">to</span> <span class="word datatype"title="">lit-word!</span> <span class="word key"title="FIRST series">first</span> <span class="word">words</span>)]<br />]</p></div></div><div class="section"><h2 id="section-8">8. Hiding the support functions from the global context</h2><p>We don't want to make <span class="code"><span class="word">make-context</span></span> and <span class="code"><span class="word">modules</span></span> global, so the main code block is actually using
<span class="code"><span class="word key"title="USE words body">use</span></span> to keep it local. (We cannot use <span class="code"><span class="word">module</span></span> while defining it, can we?)</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>Hiding the support functions from the global context<span class="bra">&#9002;</span> &#8801;</p><p><span class="word key"title="USE words body">use</span> [<span class="word">make-context</span> <span class="word">modules</span>] [<br /><span class="tab">&nbsp;</span><span class="ref"><span class="bra">&#9001;</span><a href="#section-2">Overview</a><span class="bra">&#9002;</span></span><br />]</p></div></div><div class="section"><h2 id="section-9">9. How to inspect a module</h2><p>This is an example of how to inspect a module object.</p><div class="code"><p class="sectdef"><span class="bra">&#9001;</span>How to inspect a module<span class="bra">&#9002;</span> &#8801;</p><p><span class="comment">; TODO</span></p></div></div><div class="section"><h2 id="section-10">10. Credits</h2><p>Thanks to Brian Hawley and Gregg Irwin for their help during the design phase.</p></div>
    <div id="footer"><p><a href="http://www.rebol.com/">MakeDoc3 by REBOL</a> - 2-Sep-2018</p></div>
</body>
</html>
